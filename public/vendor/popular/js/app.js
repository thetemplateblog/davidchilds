(()=>{"use strict";function t(t,e,i,n,s,r,o,a){var l,c="function"==typeof t?t.options:t;if(e&&(c.render=e,c.staticRenderFns=i,c._compiled=!0),n&&(c.functional=!0),r&&(c._scopeId="data-v-"+r),o?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),s&&s.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=l):s&&(l=a?function(){s.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:s),l)if(c.functional){c._injectStyles=l;var u=c.render;c.render=function(t,e){return l.call(e),u(t,e)}}else{var f=c.beforeCreate;c.beforeCreate=f?[].concat(f,l):[l]}return{exports:t,options:c}}const e=t({mixins:[Fieldtype],inject:["storeName"],data:function(){return{editing:!1,saving:!1,pending:this.value}},computed:{input:function(){return this.$refs.input.$refs.input},entry:function(){return this.$store.state.publish[this.storeName].values.id}},methods:{edit:function(){this.editing=!0,this.input.focus()},stopEditing:function(){this.editing=!1},confirm:function(){var t=this;this.stopEditing(),this.saving=!0,this.$axios.patch(cp_url("popular/pageviews/".concat(this.entry)),{views:this.pending}).then((function(){var e=t.$dirty.has(t.storeName);t.update(t.pending),t.$dirty.state(t.storeName,e),t.$toast.success(__("Pageviews updated"))})).catch((function(){t.resetPending(),t.$toast.error(__("Something went wrong"))})).finally((function(){t.saving=!1}))},cancel:function(){this.stopEditing(),this.resetPending()},updatePending:function(t){this.pending=parseInt(t),this.pending<0&&(this.pending=0)},resetPending:function(){this.pending=this.value}}},(function(){var t=this,e=t._self._c;return e("div",[e("text-input",{ref:"input",attrs:{type:t.editing?"number":"text","is-read-only":!t.editing,value:t.pending},on:{input:t.updatePending}}),t._v(" "),t.saving?e("div",{staticClass:"mt-1 h-6 px-1 flex justify-end text-sm"},[e("loading-graphic",{attrs:{inline:"",text:t.__("Saving")}})],1):t.config.editable?e("div",{staticClass:"mt-1 h-6 px-1 flex justify-between text-sm"},[t.editing?t._e():e("button",{staticClass:"text-button text-blue hover:text-grey-80 mr-3 flex items-center outline-none",on:{click:t.edit}},[t._v("\n            "+t._s(t.__("Edit"))+"\n        ")]),t._v(" "),t.editing?e("button",{staticClass:"text-button text-blue hover:text-grey-80 mr-3 flex items-center outline-none",on:{click:t.cancel}},[t._v("\n            "+t._s(t.__("Cancel"))+"\n        ")]):t._e(),t._v(" "),t.editing?e("button",{staticClass:"text-button text-blue hover:text-grey-80 flex items-center outline-none",on:{click:t.confirm}},[t._v("\n            "+t._s(t.__("Confirm"))+"\n        ")]):t._e()]):t._e()],1)}),[],!1,null,null,null).exports;function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function s(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==i(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var s=n.call(t,e||"default");if("object"!==i(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===i(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var r=t({mixins:[{methods:{actionStarted:function(){this.loading=!0},actionCompleted:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!1,!1!==t&&(this.$events.$emit("clear-selections"),this.$events.$emit("reset-action-modals"),!1!==e.message&&this.$toast.success(e.message||__("Action completed")),this.afterActionSuccessfullyCompleted())},afterActionSuccessfullyCompleted:function(){this.request()}}},{data:function(){return{activePreset:null,activePresetPayload:{},searchQuery:"",activeFilters:{},activeFilterBadges:{}}},computed:{activeFilterCount:function(){var t=Object.keys(this.activeFilters).length;return this.activeFilters.hasOwnProperty("fields")&&(t=t+Object.keys(this.activeFilters.fields).filter((function(t){return"badge"!=t})).length-1),t},hasActiveFilters:function(){return this.activeFilterCount>0}},methods:{searchChanged:function(t){this.searchQuery=t},hasFields:function(t){for(var e in t)if(t[e])return!0;return!1},filterChanged:function(t){var e=t.handle,i=t.values,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];i&&this.hasFields(i)?Vue.set(this.activeFilters,e,i):Vue.delete(this.activeFilters,e),n&&this.unselectAllItems()},filtersChanged:function(t){for(var e in this.activeFilters={},t){var i=t[e];this.filterChanged({handle:e,values:i},!1)}this.unselectAllItems()},filtersReset:function(){this.activePreset=null,this.activePresetPayload={},this.searchQuery="",this.activeFilters={},this.activeFilterBadges={}},unselectAllItems:function(){this.$refs.dataList&&this.$refs.dataList.clearSelections()},selectPreset:function(t,e){this.activePreset=t,this.activePresetPayload=e,this.searchQuery=e.query,this.filtersChanged(e.filters)},autoApplyFilters:function(t){if(t){var e={};t.filter((function(t){return!_.isEmpty(t.auto_apply)})).forEach((function(t){e[t.handle]=t.auto_apply})),this.activeFilters=e}}}},{props:{initialPerPage:{type:Number,default:function(){return Statamic.$config.get("paginationSize")}}},data:function(){return{perPage:this.initialPerPage,page:1}},mounted:function(){this.setInitialPerPage()},methods:{setInitialPerPage:function(){this.hasPreferences&&(this.perPage=this.getPreference("per_page")||this.initialPerPage)},changePerPage:function(t){var e=this;t=parseInt(t),(this.hasPreferences?this.setPreference("per_page",t!=this.initialPerPage?t:null):Promise.resolve()).then((function(i){e.perPage=t,e.resetPage()}))},selectPage:function(t){this.page=t},resetPage:function(){this.page=1}}},{data:function(){return{preferencesPrefix:null}},computed:{hasPreferences:function(){return null!==this.preferencesPrefix}},methods:{preferencesKey:function(t){return"".concat(this.preferencesPrefix,".").concat(t)},getPreference:function(t){return this.$preferences.get(this.preferencesKey(t))},setPreference:function(t,e){return this.$preferences.set(this.preferencesKey(t),e)},removePreference:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.$preferences.remove(this.preferencesKey(t),e)}}}],props:{initialSortColumn:String,initialSortDirection:String,initialColumns:{type:Array,default:function(){return[]}},filters:Array,actionUrl:String},data:function(){return{source:null,initializing:!0,loading:!0,items:[],columns:this.initialColumns,visibleColumns:this.initialColumns.filter((function(t){return t.visible})),sortColumn:this.initialSortColumn,sortDirection:this.initialSortDirection,meta:null}},computed:{parameters:function(){return Object.assign({sort:this.sortColumn,order:this.sortDirection,page:this.page,perPage:this.perPage,search:this.searchQuery,filters:this.activeFilterParameters,columns:this.visibleColumns.map((function(t){return t.field})).join(",")},this.additionalParameters)},activeFilterParameters:function(){return utf8btoa(JSON.stringify(this.activeFilters))},additionalParameters:function(){return{}},shouldRequestFirstPage:function(){return this.page>1&&0===this.items.length&&(this.page=1,!0)}},created:function(){this.autoApplyFilters(this.filters),this.request()},watch:{parameters:{deep:!0,handler:function(t,e){e.search===t.search&&JSON.stringify(e)!==JSON.stringify(t)&&this.request()}},loading:{immediate:!0,handler:function(t){this.$progress.loading(this.listingKey,t)}},searchQuery:function(t){this.sortColumn=null,this.sortDirection=null,this.resetPage(),this.request()}},methods:{request:function(){var t=this;this.requestUrl?(this.loading=!0,this.source&&this.source.cancel(),this.source=this.$axios.CancelToken.source(),this.$axios.get(this.requestUrl,{params:this.parameters,cancelToken:this.source.token}).then((function(e){if(t.columns=e.data.meta.columns,t.activeFilterBadges=function(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}({},e.data.meta.activeFilterBadges),t.items=Object.values(e.data.data),t.meta=e.data.meta,t.shouldRequestFirstPage)return t.request();t.loading=!1,t.initializing=!1,t.afterRequestCompleted()})).catch((function(e){t.$axios.isCancel(e)||(t.loading=!1,t.initializing=!1,t.$toast.error(e.response?e.response.data.message:__("Something went wrong"),{duration:null}))}))):this.loading=!1},afterRequestCompleted:function(t){},sorted:function(t,e){this.sortColumn=t,this.sortDirection=e},removeRow:function(t){var e=t.id,i=_.indexOf(this.rows,_.findWhere(this.rows,{id:e}));this.rows.splice(i,1),0===this.rows.length&&location.reload()}}},undefined,undefined,!1,null,null,null);const o=t({mixins:[r.exports],props:{collection:String},data:function(){return{cols:[{label:"Title",field:"title",visible:!0}],listingKey:"entries",requestUrl:cp_url("collections/".concat(this.collection,"/entries")),offset:0}},watch:{loading:function(t){t||(this.offset=(this.page-1)*this.perPage)}},methods:{shorten:function(t){if(!t)return 0;if(t<1e3)return t;for(var e,i=0,n=["K","M","B","T"];i<n.length&&(e=n[i],!((t/=1e3)<1e3));i++);return"".concat(Number(t.toFixed(t<10?1:0))).concat(e)}}},(function(){var t=this,e=t._self._c;return e("div",[t.initializing?e("div",{staticClass:"loading"},[e("loading-graphic")],1):t._e(),t._v(" "),!t.initializing&&t.items.length?e("data-list",{attrs:{rows:t.items,columns:t.cols,sort:!1,"sort-column":t.sortColumn,"sort-direction":t.sortDirection},scopedSlots:t._u([{key:"default",fn:function(i){return function(t){if(null==t)throw new TypeError("Cannot destructure "+t)}(i),e("div",{},[e("data-list-table",{attrs:{loading:t.loading},scopedSlots:t._u([{key:"cell-title",fn:function(i){var n,s=i.row,r=i.displayIndex;return[e("div",{staticClass:"flex justify-between items-center"},[e("div",{staticClass:"flex-1 flex"},[e("div",{staticClass:"mr-2 px-1 bg-grey-30 text-grey-80 rounded-full"},[t._v("\n                                "+t._s(t.offset+r+1)+"\n                            ")]),t._v(" "),e("a",{attrs:{href:s.edit_url}},[t._v(t._s(s.title))])]),t._v(" "),e("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"".concat(null!==(n=s.pageviews)&&void 0!==n?n:0," views"),expression:"`${entry.pageviews ?? 0} views`"}],staticClass:"flex-0"},[t._v("\n                            "+t._s(t.shorten(s.pageviews))+"\n                            "+t._s(t.__("views"))+"\n                        ")])])]}}],null,!0)}),t._v(" "),1!=t.meta.last_page?e("data-list-pagination",{staticClass:"py-1 border-t bg-grey-20 rounded-b-lg text-sm",attrs:{"resource-meta":t.meta,"scroll-to-top":!1},on:{"page-selected":t.selectPage}}):t._e()],1)}}],null,!1,997474102)}):t.initializing||t.items.length?t._e():e("p",{staticClass:"p-2 pt-1 text-sm text-grey-50"},[t._v("\n        "+t._s(t.__("There are no entries in this collection"))+"\n    ")])],1)}),[],!1,null,null,null).exports;Statamic.booting((function(){Statamic.$components.register("pageviews-fieldtype",e),Statamic.$components.register("popular-widget",o)}))})();